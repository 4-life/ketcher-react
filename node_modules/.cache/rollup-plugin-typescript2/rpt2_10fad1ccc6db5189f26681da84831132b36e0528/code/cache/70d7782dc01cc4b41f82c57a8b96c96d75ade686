{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { fromItemsFuse, fromPaste, FunctionalGroup, getHoverToFuse, getItemsToFuse } from 'ketcher-core';\r\nclass PasteTool {\r\n    editor;\r\n    struct;\r\n    action;\r\n    mergeItems;\r\n    constructor(editor, struct) {\r\n        this.editor = editor;\r\n        this.editor.selection(null);\r\n        this.struct = struct;\r\n        const rnd = this.editor.render;\r\n        const { clientHeight, clientWidth } = rnd.clientArea;\r\n        const point = this.editor.lastEvent\r\n            ? rnd.page2obj(this.editor.lastEvent)\r\n            : rnd.page2obj({\r\n                pageX: clientWidth / 2,\r\n                pageY: clientHeight / 2\r\n            });\r\n        const [action, pasteItems] = fromPaste(rnd.ctab, this.struct, point);\r\n        this.action = action;\r\n        this.editor.update(this.action, true);\r\n        this.mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n        this.editor.hover(getHoverToFuse(this.mergeItems), this);\r\n    }\r\n    mousemove(event) {\r\n        const rnd = this.editor.render;\r\n        if (this.action) {\r\n            this.action.perform(rnd.ctab);\r\n        }\r\n        const [action, pasteItems] = fromPaste(rnd.ctab, this.struct, rnd.page2obj(event));\r\n        this.action = action;\r\n        this.editor.update(this.action, true);\r\n        this.mergeItems = getItemsToFuse(this.editor, pasteItems);\r\n        this.editor.hover(getHoverToFuse(this.mergeItems));\r\n    }\r\n    mouseup() {\r\n        const struct = this.editor.render.ctab;\r\n        const molecule = struct.molecule;\r\n        const functionalGroups = molecule.functionalGroups;\r\n        const atomsResult = [];\r\n        const bondsResult = [];\r\n        const result = [];\r\n        if (this.mergeItems &&\r\n            functionalGroups.size &&\r\n            this.mergeItems.atoms.size) {\r\n            for (const id of this.mergeItems.atoms.values()) {\r\n                const atomId = FunctionalGroup.atomsInFunctionalGroup(functionalGroups, id);\r\n                if (atomId !== null) {\r\n                    atomsResult.push(atomId);\r\n                }\r\n            }\r\n        }\r\n        if (this.mergeItems &&\r\n            functionalGroups.size &&\r\n            this.mergeItems.bonds.size) {\r\n            for (const id of this.mergeItems.bonds.values()) {\r\n                const bondId = FunctionalGroup.atomsInFunctionalGroup(functionalGroups, id);\r\n                if (bondId !== null) {\r\n                    bondsResult.push(bondId);\r\n                }\r\n            }\r\n        }\r\n        if (atomsResult.length > 0) {\r\n            for (const id of atomsResult) {\r\n                const fgId = FunctionalGroup.findFunctionalGroupByAtom(functionalGroups, id);\r\n                if (fgId !== null && !result.includes(fgId)) {\r\n                    result.push(fgId);\r\n                }\r\n            }\r\n            this.editor.event.removeFG.dispatch({ fgIds: result });\r\n            return;\r\n        }\r\n        else if (bondsResult.length > 0) {\r\n            for (const id of bondsResult) {\r\n                const fgId = FunctionalGroup.findFunctionalGroupByBond(molecule, functionalGroups, id);\r\n                if (fgId !== null && !result.includes(fgId)) {\r\n                    result.push(fgId);\r\n                }\r\n            }\r\n            this.editor.event.removeFG.dispatch({ fgIds: result });\r\n            return;\r\n        }\r\n        const editor = this.editor;\r\n        const restruct = editor.render.ctab;\r\n        editor.selection(null);\r\n        this.action = this.action\r\n            ? fromItemsFuse(restruct, this.mergeItems).mergeWith(this.action)\r\n            : fromItemsFuse(restruct, this.mergeItems);\r\n        editor.hover(null);\r\n        if (this.action) {\r\n            const action = this.action;\r\n            delete this.action;\r\n            this.editor.update(action);\r\n        }\r\n    }\r\n    cancel() {\r\n        const rnd = this.editor.render;\r\n        this.editor.hover(null);\r\n        if (this.action) {\r\n            this.action.perform(rnd.ctab); // revert the action\r\n            delete this.action;\r\n            rnd.update();\r\n        }\r\n    }\r\n    mouseleave() {\r\n        this.cancel();\r\n    }\r\n}\r\nexport default PasteTool;\r\n//# sourceMappingURL=paste.js.map","references":["/home/ubuntu/work/4life/ketcher/packages/ketcher-core/dist/index.d.ts","/home/ubuntu/work/4life/ketcher/packages/ketcher-react/src/script/editor/Editor.ts"],"map":"{\"version\":3,\"file\":\"paste.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/script/editor/tool/paste.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/ubuntu/work/4life/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/editor/tool/paste.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Struct } from 'ketcher-core';\r\nimport Editor from '../Editor';\r\ndeclare class PasteTool {\r\n    editor: Editor;\r\n    struct: Struct;\r\n    action: any;\r\n    mergeItems: any;\r\n    constructor(editor: any, struct: any);\r\n    mousemove(event: any): void;\r\n    mouseup(): void;\r\n    cancel(): void;\r\n    mouseleave(): void;\r\n}\r\nexport default PasteTool;\r\n"}}
