{"code":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Pile, Render, Struct, Vec2, fromDescriptorsAlign, fromNewCanvas, FunctionalGroup } from 'ketcher-core';\r\nimport { DOMSubscription, PipelineSubscription, Subscription } from 'subscription';\r\nimport closest from './shared/closest';\r\nimport { customOnChangeHandler } from './utils';\r\nimport { isEqual } from 'lodash/fp';\r\nimport toolMap from './tool';\r\nimport { Highlighter } from './highlighter';\r\nconst SCALE = 40;\r\nconst HISTORY_SIZE = 32; // put me to options\r\nconst HOVER_ICON_OPACITY = 0.7;\r\nconst structObjects = [\r\n    'atoms',\r\n    'bonds',\r\n    'frags',\r\n    'sgroups',\r\n    'sgroupData',\r\n    'rgroups',\r\n    'rxnArrows',\r\n    'rxnPluses',\r\n    'enhancedFlags',\r\n    'simpleObjects',\r\n    'texts'\r\n];\r\nconst highlightTargets = [\r\n    'atoms',\r\n    'bonds',\r\n    'rxnArrows',\r\n    'rxnPluses',\r\n    'functionalGroups',\r\n    'frags',\r\n    'merge',\r\n    'rgroups',\r\n    'sgroups',\r\n    'sgroupData',\r\n    'enhancedFlags',\r\n    'simpleObjects',\r\n    'texts'\r\n];\r\nfunction selectStereoFlagsIfNecessary(atoms, expAtoms) {\r\n    const atomsOfFragments = {};\r\n    atoms.forEach((atom, atomId) => {\r\n        atomsOfFragments[atom.fragment]\r\n            ? atomsOfFragments[atom.fragment].push(atomId)\r\n            : (atomsOfFragments[atom.fragment] = [atomId]);\r\n    });\r\n    const stereoFlags = [];\r\n    Object.keys(atomsOfFragments).forEach((fragId) => {\r\n        let shouldSelSFlag = true;\r\n        atomsOfFragments[fragId].forEach((atomId) => {\r\n            if (!expAtoms.includes(atomId))\r\n                shouldSelSFlag = false;\r\n        });\r\n        shouldSelSFlag && stereoFlags.push(Number(fragId));\r\n    });\r\n    return stereoFlags;\r\n}\r\nclass Editor {\r\n    #origin;\r\n    render;\r\n    _selection;\r\n    _tool;\r\n    historyStack;\r\n    historyPtr;\r\n    errorHandler;\r\n    highlights;\r\n    hoverIcon;\r\n    event;\r\n    lastEvent;\r\n    constructor(clientArea, options) {\r\n        this.render = new Render(clientArea, Object.assign({\r\n            scale: SCALE\r\n        }, options));\r\n        this._selection = null; // eslint-disable-line\r\n        this._tool = null; // eslint-disable-line\r\n        this.historyStack = [];\r\n        this.historyPtr = 0;\r\n        this.errorHandler = null;\r\n        this.highlights = new Highlighter(this);\r\n        this.renderAndRecoordinateStruct =\r\n            this.renderAndRecoordinateStruct.bind(this);\r\n        this.setOptions = this.setOptions.bind(this);\r\n        this.hoverIcon = this.render.paper\r\n            .text(0, 0, '')\r\n            .attr('font-size', options.fontsz)\r\n            .attr('opacity', HOVER_ICON_OPACITY);\r\n        this.event = {\r\n            message: new Subscription(),\r\n            elementEdit: new PipelineSubscription(),\r\n            bondEdit: new PipelineSubscription(),\r\n            rgroupEdit: new PipelineSubscription(),\r\n            sgroupEdit: new PipelineSubscription(),\r\n            sdataEdit: new PipelineSubscription(),\r\n            quickEdit: new PipelineSubscription(),\r\n            attachEdit: new PipelineSubscription(),\r\n            removeFG: new PipelineSubscription(),\r\n            change: new Subscription(),\r\n            selectionChange: new PipelineSubscription(),\r\n            aromatizeStruct: new PipelineSubscription(),\r\n            dearomatizeStruct: new PipelineSubscription(),\r\n            // TODO: correct\r\n            enhancedStereoEdit: new PipelineSubscription(),\r\n            confirm: new PipelineSubscription(),\r\n            cursor: new PipelineSubscription(),\r\n            showInfo: new PipelineSubscription()\r\n        };\r\n        domEventSetup(this, clientArea);\r\n    }\r\n    isDitrty() {\r\n        const position = this.historyPtr;\r\n        const length = this.historyStack.length;\r\n        if (!length || !this.#origin) {\r\n            return false;\r\n        }\r\n        return !isEqual(this.historyStack[position - 1], this.#origin);\r\n    }\r\n    setOrigin() {\r\n        const position = this.historyPtr;\r\n        this.#origin = position ? this.historyStack[position - 1] : null;\r\n    }\r\n    tool(name, opts) {\r\n        /* eslint-disable no-underscore-dangle */\r\n        if (arguments.length === 0) {\r\n            return this._tool;\r\n        }\r\n        if (this._tool && this._tool.cancel) {\r\n            this._tool.cancel();\r\n        }\r\n        const tool = new toolMap[name](this, opts);\r\n        const isAtomToolChosen = name === 'atom';\r\n        if (!isAtomToolChosen) {\r\n            this.hoverIcon.hide();\r\n        }\r\n        if (!tool || tool.isNotActiveTool) {\r\n            return null;\r\n        }\r\n        this._tool = tool;\r\n        return this._tool;\r\n        /* eslint-enable no-underscore-dangle */\r\n    }\r\n    clear() {\r\n        this.struct(undefined);\r\n    }\r\n    renderAndRecoordinateStruct(struct) {\r\n        const action = fromNewCanvas(this.render.ctab, struct);\r\n        this.update(action);\r\n        const structCenter = getStructCenter(this.render.ctab);\r\n        recoordinate(this, structCenter);\r\n        return this.render.ctab.molecule;\r\n    }\r\n    struct(value) {\r\n        if (arguments.length === 0) {\r\n            return this.render.ctab.molecule;\r\n        }\r\n        this.selection(null);\r\n        const struct = value || new Struct();\r\n        return this.renderAndRecoordinateStruct(struct);\r\n    }\r\n    // this is used by API addFragment method\r\n    structToAddFragment(value) {\r\n        const superStruct = value.mergeInto(this.render.ctab.molecule);\r\n        return this.renderAndRecoordinateStruct(superStruct);\r\n    }\r\n    setOptions(opts) {\r\n        return this.render.updateOptions(opts);\r\n    }\r\n    options(value) {\r\n        if (arguments.length === 0) {\r\n            return this.render.options;\r\n        }\r\n        const struct = this.render.ctab.molecule;\r\n        const zoom = this.render.options.zoom;\r\n        this.render.clientArea.innerHTML = '';\r\n        this.render = new Render(this.render.clientArea, Object.assign({ scale: SCALE }, value));\r\n        this.render.setMolecule(struct); // TODO: reuse this.struct here?\r\n        this.render.setZoom(zoom);\r\n        this.render.update();\r\n        return this.render.options;\r\n    }\r\n    zoom(value) {\r\n        if (arguments.length === 0) {\r\n            return this.render.options.zoom;\r\n        }\r\n        this.render.setZoom(value);\r\n        const selection = this.selection();\r\n        const structCenter = getStructCenter(this.render.ctab, selection);\r\n        recoordinate(this, structCenter);\r\n        this.render.update();\r\n        return this.render.options.zoom;\r\n    }\r\n    selection(ci) {\r\n        if (arguments.length === 0) {\r\n            return this._selection; // eslint-disable-line\r\n        }\r\n        let ReStruct = this.render.ctab;\r\n        this._selection = null; // eslint-disable-line\r\n        if (ci === 'all') {\r\n            // TODO: better way will be this.struct()\r\n            ci = structObjects.reduce((res, key) => {\r\n                res[key] = Array.from(ReStruct[key].keys());\r\n                return res;\r\n            }, {});\r\n        }\r\n        if (ci === 'descriptors') {\r\n            ReStruct = this.render.ctab;\r\n            ci = { sgroupData: Array.from(ReStruct.sgroupData.keys()) };\r\n        }\r\n        if (ci) {\r\n            const res = {};\r\n            Object.keys(ci).forEach((key) => {\r\n                if (ci[key].length > 0)\r\n                    // TODO: deep merge\r\n                    res[key] = ci[key].slice();\r\n            });\r\n            if (Object.keys(res).length !== 0) {\r\n                this._selection = res; // eslint-disable-line\r\n            }\r\n            const stereoFlags = selectStereoFlagsIfNecessary(this.struct().atoms, this.explicitSelected().atoms);\r\n            if (stereoFlags.length !== 0) {\r\n                this._selection && this._selection.enhancedFlags\r\n                    ? (this._selection.enhancedFlags = Array.from(new Set([...this._selection.enhancedFlags, ...stereoFlags])))\r\n                    : (res.enhancedFlags = stereoFlags);\r\n            }\r\n        }\r\n        this.render.ctab.setSelection(this._selection); // eslint-disable-line\r\n        this.event.selectionChange.dispatch(this._selection); // eslint-disable-line\r\n        this.render.update();\r\n        return this._selection; // eslint-disable-line\r\n    }\r\n    hover(ci, newTool, event) {\r\n        const tool = newTool || this._tool; // eslint-disable-line\r\n        let infoPanelData = null;\r\n        if ('ci' in tool &&\r\n            (!ci || tool.ci.map !== ci.map || tool.ci.id !== ci.id)) {\r\n            setHover(tool.ci, false, this.render);\r\n            delete tool.ci;\r\n        }\r\n        if (ci && setHover(ci, true, this.render))\r\n            tool.ci = ci;\r\n        if (!event)\r\n            return;\r\n        const checkFunctionGroupTypes = ['sgroups', 'functionalGroups'];\r\n        const closestCollapsibleStructures = this.findItem(event, checkFunctionGroupTypes);\r\n        if (closestCollapsibleStructures) {\r\n            const sGroup = this.struct()?.sgroups.get(closestCollapsibleStructures.id);\r\n            if (sGroup && !sGroup.data.expanded) {\r\n                const groupName = sGroup.data.name;\r\n                const groupStruct = FunctionalGroup.getFunctionalGroupByName(groupName);\r\n                infoPanelData = {\r\n                    groupStruct,\r\n                    event,\r\n                    sGroup\r\n                };\r\n            }\r\n        }\r\n        if (infoPanelData) {\r\n            this.event.showInfo.dispatch(infoPanelData);\r\n        }\r\n        else {\r\n            this.event.showInfo.dispatch(null);\r\n        }\r\n    }\r\n    update(action, ignoreHistory) {\r\n        if (action === true) {\r\n            this.render.update(true); // force\r\n        }\r\n        else {\r\n            if (!ignoreHistory && !action.isDummy()) {\r\n                this.historyStack.splice(this.historyPtr, HISTORY_SIZE + 1, action);\r\n                if (this.historyStack.length > HISTORY_SIZE) {\r\n                    this.historyStack.shift();\r\n                }\r\n                this.historyPtr = this.historyStack.length;\r\n                this.event.change.dispatch(action); // TODO: stoppable here\r\n            }\r\n            this.render.update();\r\n        }\r\n    }\r\n    historySize() {\r\n        return {\r\n            undo: this.historyPtr,\r\n            redo: this.historyStack.length - this.historyPtr\r\n        };\r\n    }\r\n    undo() {\r\n        if (this.historyPtr === 0) {\r\n            throw new Error('Undo stack is empty');\r\n        }\r\n        if (this.tool() && this.tool().cancel) {\r\n            this.tool().cancel();\r\n        }\r\n        this.selection(null);\r\n        if (this._tool instanceof toolMap.paste) {\r\n            this.event.change.dispatch();\r\n            return;\r\n        }\r\n        this.historyPtr--;\r\n        const stack = this.historyStack[this.historyPtr];\r\n        const action = stack.perform(this.render.ctab);\r\n        this.historyStack[this.historyPtr] = action;\r\n        this.event.change.dispatch(action);\r\n        this.render.update();\r\n    }\r\n    redo() {\r\n        if (this.historyPtr === this.historyStack.length) {\r\n            throw new Error('Redo stack is empty');\r\n        }\r\n        if (this.tool() && this.tool().cancel) {\r\n            this.tool().cancel();\r\n        }\r\n        this.selection(null);\r\n        if (this._tool instanceof toolMap.paste) {\r\n            this.event.change.dispatch();\r\n            return;\r\n        }\r\n        const action = this.historyStack[this.historyPtr].perform(this.render.ctab);\r\n        this.historyStack[this.historyPtr] = action;\r\n        this.historyPtr++;\r\n        this.event.change.dispatch(action);\r\n        this.render.update();\r\n    }\r\n    subscribe(eventName, handler) {\r\n        const subscriber = {\r\n            handler: handler\r\n        };\r\n        switch (eventName) {\r\n            case 'change':\r\n                const subscribeFuncWrapper = (action) => customOnChangeHandler(action, handler);\r\n                subscriber.handler = subscribeFuncWrapper;\r\n                this.event[eventName].add(subscribeFuncWrapper);\r\n                break;\r\n            default:\r\n                this.event[eventName].add(handler);\r\n        }\r\n        return subscriber;\r\n    }\r\n    unsubscribe(eventName, subscriber) {\r\n        // Only for event type - subscription\r\n        this.event[eventName].remove(subscriber.handler);\r\n    }\r\n    findItem(event, maps, skip = null) {\r\n        const pos = new Vec2(this.render.page2obj(event));\r\n        return closest.item(this.render.ctab, pos, maps, skip, this.render.options);\r\n    }\r\n    findMerge(srcItems, maps) {\r\n        return closest.merge(this.render.ctab, srcItems, maps, this.render.options);\r\n    }\r\n    explicitSelected() {\r\n        const selection = this.selection() || {};\r\n        const res = structObjects.reduce((acc, key) => {\r\n            acc[key] = selection[key] ? selection[key].slice() : [];\r\n            return acc;\r\n        }, {});\r\n        const struct = this.render.ctab.molecule;\r\n        // \"auto-select\" the atoms for the bonds in selection\r\n        if (res.bonds) {\r\n            res.bonds.forEach((bid) => {\r\n                const bond = struct.bonds.get(bid);\r\n                res.atoms = res.atoms || [];\r\n                if (res.atoms.indexOf(bond.begin) < 0) {\r\n                    res.atoms.push(bond.begin);\r\n                }\r\n                if (res.atoms.indexOf(bond.end) < 0) {\r\n                    res.atoms.push(bond.end);\r\n                }\r\n            });\r\n        }\r\n        // \"auto-select\" the bonds with both atoms selected\r\n        if (res.atoms && res.bonds) {\r\n            struct.bonds.forEach((bond, bid) => {\r\n                if (res.bonds.indexOf(bid) >= 0 &&\r\n                    res.atoms.indexOf(bond.begin) >= 0 &&\r\n                    res.atoms.indexOf(bond.end) >= 0) {\r\n                    res.bonds = res.bonds || [];\r\n                    res.bonds.push(bid);\r\n                }\r\n            });\r\n        }\r\n        return res;\r\n    }\r\n    structSelected() {\r\n        const struct = this.render.ctab.molecule;\r\n        const selection = this.explicitSelected();\r\n        const dst = struct.clone(new Pile(selection.atoms), new Pile(selection.bonds), true, null, new Pile(selection.simpleObjects), new Pile(selection.texts));\r\n        // Copy by its own as Struct.clone doesn't support\r\n        // arrows/pluses id sets\r\n        struct.rxnArrows.forEach((item, id) => {\r\n            if (selection.rxnArrows.indexOf(id) !== -1)\r\n                dst.rxnArrows.add(item.clone());\r\n        });\r\n        struct.rxnPluses.forEach((item, id) => {\r\n            if (selection.rxnPluses.indexOf(id) !== -1)\r\n                dst.rxnPluses.add(item.clone());\r\n        });\r\n        dst.isReaction = struct.isReaction && struct.isRxn();\r\n        return dst;\r\n    }\r\n    alignDescriptors() {\r\n        this.selection(null);\r\n        const action = fromDescriptorsAlign(this.render.ctab);\r\n        this.update(action);\r\n        this.render.update(true);\r\n    }\r\n}\r\nfunction isMouseRight(event) {\r\n    return ((event.which && event.which === 3) || (event.button && event.button === 2));\r\n}\r\nfunction domEventSetup(editor, clientArea) {\r\n    // TODO: addEventListener('resize', ...);\r\n    ;\r\n    [\r\n        'click',\r\n        'dblclick',\r\n        'mousedown',\r\n        'mousemove',\r\n        'mouseup',\r\n        'mouseleave',\r\n        'mouseover'\r\n    ].forEach((eventName) => {\r\n        editor.event[eventName] = new DOMSubscription();\r\n        const subs = editor.event[eventName];\r\n        clientArea.addEventListener(eventName, subs.dispatch.bind(subs));\r\n        subs.add((event) => {\r\n            if (eventName !== 'mouseup' && eventName !== 'mouseleave') {\r\n                // to complete drag actions\r\n                if (isMouseRight(event) ||\r\n                    !event.target ||\r\n                    event.target.nodeName === 'DIV') {\r\n                    // click on scroll\r\n                    editor.hover(null);\r\n                    return true;\r\n                }\r\n            }\r\n            const EditorTool = editor.tool();\r\n            editor.lastEvent = event;\r\n            if (EditorTool && eventName in EditorTool) {\r\n                EditorTool[eventName](event);\r\n            }\r\n            return true;\r\n        }, -1);\r\n    });\r\n}\r\nfunction recoordinate(editor, rp /* , vp */) {\r\n    // rp is a point in scaled coordinates, which will be positioned\r\n    // vp is the point where the reference point should now be (in view coordinates)\r\n    //    or the center if not set\r\n    console.assert(rp, 'Reference point not specified');\r\n    if (rp) {\r\n        editor.render.setScrollOffset(rp.x, rp.y);\r\n    }\r\n    else {\r\n        editor.render.setScrollOffset(0, 0);\r\n    }\r\n}\r\nfunction getStructCenter(ReStruct, selection) {\r\n    const bb = ReStruct.getVBoxObj(selection || {});\r\n    return Vec2.lc2(bb.p0, 0.5, bb.p1, 0.5);\r\n}\r\nexport { Editor };\r\nexport default Editor;\r\nfunction setHover(ci, visible, render) {\r\n    if (highlightTargets.indexOf(ci.map) === -1) {\r\n        return false;\r\n    }\r\n    let item = null;\r\n    if (ci.map === 'merge') {\r\n        Object.keys(ci.items).forEach((mp) => {\r\n            ci.items[mp].forEach((dstId) => {\r\n                item = render.ctab[mp].get(dstId);\r\n                if (item) {\r\n                    item.setHover(visible, render);\r\n                }\r\n            });\r\n        });\r\n        return true;\r\n    }\r\n    if (ci.map === 'functionalGroups')\r\n        ci.map = 'sgroups'; // TODO: Refactor object\r\n    item = render.ctab[ci.map].get(ci.id);\r\n    if (!item) {\r\n        return true; // TODO: fix, attempt to highlight a deleted item\r\n    }\r\n    if ((ci.map === 'sgroups' && item.item.type === 'DAT') ||\r\n        ci.map === 'sgroupData') {\r\n        // set highlight for both the group and the data item\r\n        const item1 = render.ctab.sgroups.get(ci.id);\r\n        if (item1) {\r\n            item1.setHover(visible, render);\r\n        }\r\n        const item2 = render.ctab.sgroupData.get(ci.id);\r\n        if (item2) {\r\n            item2.setHover(visible, render);\r\n        }\r\n    }\r\n    else {\r\n        item.setHover(visible, render);\r\n    }\r\n    return true;\r\n}\r\n//# sourceMappingURL=Editor.js.map","references":["/home/ubuntu/work/4life/ketcher/packages/ketcher-core/dist/index.d.ts","/home/ubuntu/work/4life/ketcher/node_modules/subscription/index.js","/home/ubuntu/work/4life/ketcher/packages/ketcher-react/src/script/editor/shared/closest.js","/home/ubuntu/work/4life/ketcher/packages/ketcher-react/src/script/editor/utils/index.ts","/home/ubuntu/work/4life/ketcher/node_modules/@types/lodash/fp.d.ts","/home/ubuntu/work/4life/ketcher/packages/ketcher-react/src/script/editor/tool/index.js","/home/ubuntu/work/4life/ketcher/packages/ketcher-react/src/script/editor/highlighter.ts"],"map":"{\"version\":3,\"file\":\"Editor.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/script/editor/Editor.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/ubuntu/work/4life/ketcher/packages/ketcher-react/node_modules/.cache/rollup-plugin-typescript2/placeholder/script/editor/Editor.d.ts","writeByteOrderMark":false,"text":"/****************************************************************************\r\n * Copyright 2021 EPAM Systems\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *    http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n ***************************************************************************/\r\nimport { Action, Editor as KetcherEditor, Render, Struct } from 'ketcher-core';\r\nimport { PipelineSubscription, Subscription } from 'subscription';\r\nimport { Highlighter } from './highlighter';\r\ninterface Selection {\r\n    atoms?: Array<number>;\r\n    bonds?: Array<number>;\r\n    enhancedFlags?: Array<number>;\r\n    rxnPluses?: Array<number>;\r\n    rxnArrows?: Array<number>;\r\n}\r\ndeclare class Editor implements KetcherEditor {\r\n    #private;\r\n    render: Render;\r\n    _selection: Selection | null;\r\n    _tool: any;\r\n    historyStack: any;\r\n    historyPtr: any;\r\n    errorHandler: ((message: string) => void) | null;\r\n    highlights: Highlighter;\r\n    hoverIcon: any;\r\n    event: {\r\n        message: Subscription;\r\n        elementEdit: PipelineSubscription;\r\n        bondEdit: PipelineSubscription;\r\n        rgroupEdit: PipelineSubscription;\r\n        sgroupEdit: PipelineSubscription;\r\n        sdataEdit: PipelineSubscription;\r\n        quickEdit: PipelineSubscription;\r\n        attachEdit: PipelineSubscription;\r\n        removeFG: PipelineSubscription;\r\n        change: Subscription;\r\n        selectionChange: PipelineSubscription;\r\n        aromatizeStruct: PipelineSubscription;\r\n        dearomatizeStruct: PipelineSubscription;\r\n        enhancedStereoEdit: PipelineSubscription;\r\n        confirm: PipelineSubscription;\r\n        showInfo: PipelineSubscription;\r\n        cursor: Subscription;\r\n    };\r\n    lastEvent: any;\r\n    constructor(clientArea: any, options: any);\r\n    isDitrty(): boolean;\r\n    setOrigin(): void;\r\n    tool(name?: any, opts?: any): any;\r\n    clear(): void;\r\n    renderAndRecoordinateStruct(struct: Struct): Struct;\r\n    struct(value?: Struct): Struct;\r\n    structToAddFragment(value: Struct): Struct;\r\n    setOptions(opts: string): any;\r\n    options(value?: any): any;\r\n    zoom(value?: any): any;\r\n    selection(ci?: any): Selection | null;\r\n    hover(ci: any, newTool?: any, event?: PointerEvent): void;\r\n    update(action: Action | true, ignoreHistory?: any): void;\r\n    historySize(): {\r\n        undo: any;\r\n        redo: number;\r\n    };\r\n    undo(): void;\r\n    redo(): void;\r\n    subscribe(eventName: any, handler: any): {\r\n        handler: any;\r\n    };\r\n    unsubscribe(eventName: any, subscriber: any): void;\r\n    findItem(event: any, maps: any, skip?: any): any;\r\n    findMerge(srcItems: any, maps: any): {\r\n        atoms: Map<number, number>;\r\n        bonds: Map<number, number> | null;\r\n    };\r\n    explicitSelected(): any;\r\n    structSelected(): Struct;\r\n    alignDescriptors(): void;\r\n}\r\nexport { Editor };\r\nexport default Editor;\r\n"}}
